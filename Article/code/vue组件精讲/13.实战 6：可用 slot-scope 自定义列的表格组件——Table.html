<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>实战 6：可用 slot-scope 自定义列的表格组件——Table | 源于生活</title>
    <meta name="description" content="write something">
    <meta name="generator" content="VuePress 1.3.0">
    
    
    <link rel="preload" href="/assets/css/0.styles.2e629a8b.css" as="style"><link rel="preload" href="/assets/js/app.3f86075b.js" as="script"><link rel="preload" href="/assets/js/2.b61884c0.js" as="script"><link rel="preload" href="/assets/js/15.8f783edc.js" as="script"><link rel="prefetch" href="/assets/js/10.43843a91.js"><link rel="prefetch" href="/assets/js/11.6144a746.js"><link rel="prefetch" href="/assets/js/12.931ab5ee.js"><link rel="prefetch" href="/assets/js/13.200ba20e.js"><link rel="prefetch" href="/assets/js/14.78767d2c.js"><link rel="prefetch" href="/assets/js/16.9226847d.js"><link rel="prefetch" href="/assets/js/17.bf6644b0.js"><link rel="prefetch" href="/assets/js/18.14599e53.js"><link rel="prefetch" href="/assets/js/19.734e752a.js"><link rel="prefetch" href="/assets/js/20.3a5561e3.js"><link rel="prefetch" href="/assets/js/21.7064855e.js"><link rel="prefetch" href="/assets/js/22.f968cb6c.js"><link rel="prefetch" href="/assets/js/23.f03e443c.js"><link rel="prefetch" href="/assets/js/24.64ce1052.js"><link rel="prefetch" href="/assets/js/25.f684b2ad.js"><link rel="prefetch" href="/assets/js/26.545ca9e8.js"><link rel="prefetch" href="/assets/js/27.437372e3.js"><link rel="prefetch" href="/assets/js/28.3dbb8fe4.js"><link rel="prefetch" href="/assets/js/29.badca37d.js"><link rel="prefetch" href="/assets/js/3.606f011a.js"><link rel="prefetch" href="/assets/js/30.a93aa9de.js"><link rel="prefetch" href="/assets/js/31.1fba5591.js"><link rel="prefetch" href="/assets/js/32.bc8d95d4.js"><link rel="prefetch" href="/assets/js/33.46e8b848.js"><link rel="prefetch" href="/assets/js/34.259ea87a.js"><link rel="prefetch" href="/assets/js/35.6cb77e7b.js"><link rel="prefetch" href="/assets/js/36.dfa5f43c.js"><link rel="prefetch" href="/assets/js/37.ce07fe30.js"><link rel="prefetch" href="/assets/js/38.9aedea0c.js"><link rel="prefetch" href="/assets/js/39.12d20f3b.js"><link rel="prefetch" href="/assets/js/4.5960558f.js"><link rel="prefetch" href="/assets/js/40.0d7119e5.js"><link rel="prefetch" href="/assets/js/41.c463fcdd.js"><link rel="prefetch" href="/assets/js/42.75948f81.js"><link rel="prefetch" href="/assets/js/43.a64e9f06.js"><link rel="prefetch" href="/assets/js/44.9a36c39e.js"><link rel="prefetch" href="/assets/js/45.d55c6f21.js"><link rel="prefetch" href="/assets/js/5.722aa9ed.js"><link rel="prefetch" href="/assets/js/6.7cf19e7f.js"><link rel="prefetch" href="/assets/js/7.57aaa45a.js"><link rel="prefetch" href="/assets/js/8.9246eb47.js"><link rel="prefetch" href="/assets/js/9.b56c8b97.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2e629a8b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">源于生活</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>关于code</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>vue组件</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Article/code/vue组件精讲/1.vue.js的精髓--组件.html" class="sidebar-link">开篇：Vue.js 的精髓——组件</a></li><li><a href="/Article/code/vue组件精讲/2.基础：Vue.js 组件的三个 API：prop、event、slot.html" class="sidebar-link">基础：Vue.js 组件的三个 API：prop、event、slot</a></li><li><a href="/Article/code/vue组件精讲/4.组件的通信 2：派发与广播——自行实现 dispatch 和 broadcast 方法.html" class="sidebar-link">组件的通信 2：派发与广播——自行实现 dispatch 和 broadcast 方法</a></li><li><a href="/Article/code/vue组件精讲/5.实战 1：具有数据校验功能的表单组件——Form.html" class="sidebar-link">实战 1：具有数据校验功能的表单组件——Form</a></li><li><a href="/Article/code/vue组件精讲/6.组件的通信 3：找到任意组件实例——findComponents 系列方法.html" class="sidebar-link">组件的通信 3：找到任意组件实例——findComponents 系列方法</a></li><li><a href="/Article/code/vue组件精讲/7.实战 2：组合多选框组件——CheckboxGroup &amp; Checkbox.html" class="sidebar-link">实战 2：组合多选框组件——CheckboxGroup &amp; Checkbox</a></li><li><a href="/Article/code/vue组件精讲/8.Vue 的构造器——extend 与手动挂载——$mount.html" class="sidebar-link">Vue 的构造器——extend 与手动挂载——$mount</a></li><li><a href="/Article/code/vue组件精讲/9.实战 3：动态渲染 .vue 文件的组件—— Display.html" class="sidebar-link">实战 3：动态渲染 .vue 文件的组件—— Display</a></li><li><a href="/Article/code/vue组件精讲/10.实战 4：全局提示组件——$Alert.html" class="sidebar-link">实战 4：全局提示组件——$Alert</a></li><li><a href="/Article/code/vue组件精讲/11.更灵活的组件：Render 函数与 Functional Render.html" class="sidebar-link">更灵活的组件：Render 函数与 Functional Render</a></li><li><a href="/Article/code/vue组件精讲/12.实战 5：可用 Render 自定义列的表格组件——Table.html" class="sidebar-link">实战 5：可用 Render 自定义列的表格组件——Table</a></li><li><a href="/Article/code/vue组件精讲/13.实战 6：可用 slot-scope 自定义列的表格组件——Table.html" class="active sidebar-link">实战 6：可用 slot-scope 自定义列的表格组件——Table</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Article/code/vue组件精讲/13.实战 6：可用 slot-scope 自定义列的表格组件——Table.html#什么是-slot-scope" class="sidebar-link">什么是 slot-scope</a></li><li class="sidebar-sub-header"><a href="/Article/code/vue组件精讲/13.实战 6：可用 slot-scope 自定义列的表格组件——Table.html#方案一" class="sidebar-link">方案一</a></li><li class="sidebar-sub-header"><a href="/Article/code/vue组件精讲/13.实战 6：可用 slot-scope 自定义列的表格组件——Table.html#方案二" class="sidebar-link">方案二</a></li><li class="sidebar-sub-header"><a href="/Article/code/vue组件精讲/13.实战 6：可用 slot-scope 自定义列的表格组件——Table.html#方案三" class="sidebar-link">方案三</a></li><li class="sidebar-sub-header"><a href="/Article/code/vue组件精讲/13.实战 6：可用 slot-scope 自定义列的表格组件——Table.html#结语" class="sidebar-link">结语</a></li></ul></li><li><a href="/Article/code/vue组件精讲/14.递归组件与动态组件.html" class="sidebar-link">递归组件与动态组件</a></li><li><a href="/Article/code/vue组件精讲/15.实战 7：树形控件——Tree.html" class="sidebar-link">实战 7：树形控件——Tree</a></li><li><a href="/Article/code/vue组件精讲/16.拓展：Vue.js 容易忽略的 API 详解.html" class="sidebar-link">拓展：Vue.js 容易忽略的 API 详解</a></li><li><a href="/Article/code/vue组件精讲/17.拓展：Vue.js 面试、常见问题答疑.html" class="sidebar-link">拓展：Vue.js 面试、常见问题答疑</a></li><li><a href="/Article/code/vue组件精讲/18.拓展：如何做好一个开源项目（上篇）.html" class="sidebar-link">拓展：如何做好一个开源项目（上篇）</a></li><li><a href="/Article/code/vue组件精讲/19.拓展：如何做好一个开源项目（下篇）.html" class="sidebar-link">拓展：如何做好一个开源项目（下篇）</a></li><li><a href="/Article/code/vue组件精讲/20.写在最后.html" class="sidebar-link">/Article/code/vue组件精讲/20.写在最后.html</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="实战-6：可用-slot-scope-自定义列的表格组件——table"><a href="#实战-6：可用-slot-scope-自定义列的表格组件——table" class="header-anchor">#</a> 实战 6：可用 slot-scope 自定义列的表格组件——Table</h1> <p>上一节，我们基于 Render 函数实现了在表格中自定义列模板的组件 Table，虽说 Render 函数能够完全发挥 JavaScript 的编程能力，实现几乎所有的自定义工作，但本质上，使用者写的是一个庞大的 JS 对象，它不具备 DOM 结构，可读性和可维护性都比较差。对于大部分写 Vue.js 的开发者来说，更倾向于使用 template 的语法，毕竟它是 Vue.js 独有的特性。本小节则在上一节的 Table 组件基础上修改，实现一种达到同样渲染效果，但对使用者更友好的 slot-scope 写法。</p> <h2 id="什么是-slot-scope"><a href="#什么是-slot-scope" class="header-anchor">#</a> 什么是 slot-scope</h2> <p>slot（插槽）我们都很熟悉，它是 Vue.js 组件的 3 个 API 之一，用于分发内容。那 slot-scope 是什么呢？先来看一个场景，比如某组件拥有下面的模板：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>li v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;book in books&quot;</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">&quot;book.id&quot;</span><span class="token operator">&gt;</span>
    <span class="token punctuation">{</span><span class="token punctuation">{</span> book<span class="token punctuation">.</span>name <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
</code></pre></div><p>使用者传递一个数组 <code>books</code>，由组件内的 <code>v-for</code> 循环显示，这里的 <code>book.name</code> 是纯文本输出，如果想自定义它的模板（即内容分发），就要用到 slot，但 slot 只能是固定的模板，没法自定义循环体中的一个具体的项，事实上这跟上一节的 Table 场景是类似的。</p> <p>常规的 slot 无法实现对组件循环体的每一项进行不同的内容分发，这就要用到 slot-scope，它本质上跟 slot 一样，只不过可以传递参数。比如上面的示例，使用 slot-scope 封装：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-js"><code><span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>li v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;book in books&quot;</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">&quot;book.id&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>slot <span class="token operator">:</span>book<span class="token operator">=</span><span class="token string">&quot;book&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 默认内容 <span class="token operator">--</span><span class="token operator">&gt;</span>
      <span class="token punctuation">{</span><span class="token punctuation">{</span> book<span class="token punctuation">.</span>name <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
</code></pre></div><p>在 slot 上，传递了一个自定义的参数 <code>book</code>，它的值绑定的是当前循环项的数据 book，这样在父级使用时，就可以在 slot 中访问它了：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code><span class="token operator">&lt;</span>book<span class="token operator">-</span>list <span class="token operator">:</span>books<span class="token operator">=</span><span class="token string">&quot;books&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>template slot<span class="token operator">-</span>scope<span class="token operator">=</span><span class="token string">&quot;slotProps&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>span v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;slotProps.book.sale&quot;</span><span class="token operator">&gt;</span>限时优惠<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
    <span class="token punctuation">{</span><span class="token punctuation">{</span> slotProps<span class="token punctuation">.</span>book<span class="token punctuation">.</span>name <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>book<span class="token operator">-</span>list<span class="token operator">&gt;</span>
</code></pre></div><p>使用 slot-scope 指定的参数 <code>slotProps</code> 就是这个 slot 的全部参数，它是一个对象，在 slot-scope 中是可以传递多个参数的，上例我们只写了一个参数 <code>book</code>，所以访问它就是 <code>slotProps.book</code>。这里推荐使用 ES6 的解构，能让参数使用起来更方便：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code><span class="token operator">&lt;</span>book<span class="token operator">-</span>list <span class="token operator">:</span>books<span class="token operator">=</span><span class="token string">&quot;books&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>template slot<span class="token operator">-</span>scope<span class="token operator">=</span><span class="token string">&quot;{ book }&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>span v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;book.sale&quot;</span><span class="token operator">&gt;</span>限时优惠<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
    <span class="token punctuation">{</span><span class="token punctuation">{</span> book<span class="token punctuation">.</span>name <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>book<span class="token operator">-</span>list<span class="token operator">&gt;</span>
</code></pre></div><p>除了可以传递参数，其它用法跟 slot 是一样的，比如也可以“具名”：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-js"><code><span class="token operator">&lt;</span>slot <span class="token operator">:</span>book<span class="token operator">=</span><span class="token string">&quot;book&quot;</span> name<span class="token operator">=</span><span class="token string">&quot;book&quot;</span><span class="token operator">&gt;</span>
  <span class="token punctuation">{</span><span class="token punctuation">{</span> book<span class="token punctuation">.</span>name <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>template slot<span class="token operator">-</span>scope<span class="token operator">=</span><span class="token string">&quot;{ book }&quot;</span> slot<span class="token operator">=</span><span class="token string">&quot;book&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>span v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;book.sale&quot;</span><span class="token operator">&gt;</span>限时优惠<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
  <span class="token punctuation">{</span><span class="token punctuation">{</span> book<span class="token punctuation">.</span>name <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre></div><p>这就是作用域 slot（slot-scope），能够在组件的循环体中做内容分发，有了它，Table 组件的自定义列模板就不用写一长串的 Render 函数了。</p> <p>为了把 Render 函数和 slot-scope 理解透彻，下面我们用 3 种方法来改写 Table，实现 slot-scope 自定义列模板。</p> <h2 id="方案一"><a href="#方案一" class="header-anchor">#</a> 方案一</h2> <p>第一种方案，用最简单的 slot-scope 实现，同时也兼容 Render 函数的旧用法。拷贝上一节的 Table 组件目录，更名为 <code>table-slot</code>，同时也拷贝路由，更名为 <code>table-slot.vue</code>。为了兼容旧的 Render 函数用法，在 columns 的列配置 column 中，新增一个字段 <code>slot</code> 来指定 slot-scope 的名称：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> src<span class="token operator">/</span>components<span class="token operator">/</span>table<span class="token operator">-</span>slot<span class="token operator">/</span>table<span class="token punctuation">.</span>vue <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>table<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>thead<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>tr<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>th v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;col in columns&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> col<span class="token punctuation">.</span>title <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>th<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>thead<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>tbody<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>tr v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;(row, rowIndex) in data&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>td v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;col in columns&quot;</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>template v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;'render' in col&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Render <span class="token operator">:</span>row<span class="token operator">=</span><span class="token string">&quot;row&quot;</span> <span class="token operator">:</span>column<span class="token operator">=</span><span class="token string">&quot;col&quot;</span> <span class="token operator">:</span>index<span class="token operator">=</span><span class="token string">&quot;rowIndex&quot;</span> <span class="token operator">:</span>render<span class="token operator">=</span><span class="token string">&quot;col.render&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Render<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>template v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;'slot' in col&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>slot <span class="token operator">:</span>row<span class="token operator">=</span><span class="token string">&quot;row&quot;</span> <span class="token operator">:</span>column<span class="token operator">=</span><span class="token string">&quot;col&quot;</span> <span class="token operator">:</span>index<span class="token operator">=</span><span class="token string">&quot;rowIndex&quot;</span> <span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;col.slot&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>template v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> row<span class="token punctuation">[</span>col<span class="token punctuation">.</span>key<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>tbody<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>table<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre></div><p>相比原先的文件，只在 <code>'render' in col</code> 的条件下新加了一个 <code>template</code> 的标签，如果使用者的 column 配置了 render 字段，就优先以 Render 函数渲染，然后再判断是否用 slot-scope 渲染。在定义的作用域 slot 中，将行数据 <code>row</code>、列数据 <code>column</code> 和第几行 <code>index</code> 作为 slot 的参数，并根据 column 中指定的 slot 字段值，动态设置了具名 <code>name</code>。使用者在配置 columns 时，只要指定了某一列的 slot，那就可以在 Table 组件中使用 slot-scope。我们以上一节的可编辑整行数据为例，用 slot-scope 的写法实现完全一样的效果：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> src<span class="token operator">/</span>views<span class="token operator">/</span>table<span class="token operator">-</span>slot<span class="token punctuation">.</span>vue <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>table<span class="token operator">-</span>slot <span class="token operator">:</span>columns<span class="token operator">=</span><span class="token string">&quot;columns&quot;</span> <span class="token operator">:</span>data<span class="token operator">=</span><span class="token string">&quot;data&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>template slot<span class="token operator">-</span>scope<span class="token operator">=</span><span class="token string">&quot;{ row, index }&quot;</span> slot<span class="token operator">=</span><span class="token string">&quot;name&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;editName&quot;</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;editIndex === index&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> row<span class="token punctuation">.</span>name <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

      <span class="token operator">&lt;</span>template slot<span class="token operator">-</span>scope<span class="token operator">=</span><span class="token string">&quot;{ row, index }&quot;</span> slot<span class="token operator">=</span><span class="token string">&quot;age&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;editAge&quot;</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;editIndex === index&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> row<span class="token punctuation">.</span>age <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

      <span class="token operator">&lt;</span>template slot<span class="token operator">-</span>scope<span class="token operator">=</span><span class="token string">&quot;{ row, index }&quot;</span> slot<span class="token operator">=</span><span class="token string">&quot;birthday&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;editBirthday&quot;</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;editIndex === index&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">getBirthday</span><span class="token punctuation">(</span>row<span class="token punctuation">.</span>birthday<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

      <span class="token operator">&lt;</span>template slot<span class="token operator">-</span>scope<span class="token operator">=</span><span class="token string">&quot;{ row, index }&quot;</span> slot<span class="token operator">=</span><span class="token string">&quot;address&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;editAddress&quot;</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;editIndex === index&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> row<span class="token punctuation">.</span>address <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

      <span class="token operator">&lt;</span>template slot<span class="token operator">-</span>scope<span class="token operator">=</span><span class="token string">&quot;{ row, index }&quot;</span> slot<span class="token operator">=</span><span class="token string">&quot;action&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;editIndex === index&quot;</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;handleSave(index)&quot;</span><span class="token operator">&gt;</span>保存<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;editIndex = -1&quot;</span><span class="token operator">&gt;</span>取消<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;handleEdit(row, index)&quot;</span><span class="token operator">&gt;</span>操作<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>table<span class="token operator">-</span>slot<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  <span class="token keyword">import</span> TableSlot <span class="token keyword">from</span> <span class="token string">'../components/table-slot/table.vue'</span><span class="token punctuation">;</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    components<span class="token operator">:</span> <span class="token punctuation">{</span> TableSlot <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        columns<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            title<span class="token operator">:</span> <span class="token string">'姓名'</span><span class="token punctuation">,</span>
            slot<span class="token operator">:</span> <span class="token string">'name'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            title<span class="token operator">:</span> <span class="token string">'年龄'</span><span class="token punctuation">,</span>
            slot<span class="token operator">:</span> <span class="token string">'age'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            title<span class="token operator">:</span> <span class="token string">'出生日期'</span><span class="token punctuation">,</span>
            slot<span class="token operator">:</span> <span class="token string">'birthday'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            title<span class="token operator">:</span> <span class="token string">'地址'</span><span class="token punctuation">,</span>
            slot<span class="token operator">:</span> <span class="token string">'address'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            title<span class="token operator">:</span> <span class="token string">'操作'</span><span class="token punctuation">,</span>
            slot<span class="token operator">:</span> <span class="token string">'action'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">'王小明'</span><span class="token punctuation">,</span>
            age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
            birthday<span class="token operator">:</span> <span class="token string">'919526400000'</span><span class="token punctuation">,</span>
            address<span class="token operator">:</span> <span class="token string">'北京市朝阳区芍药居'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">'张小刚'</span><span class="token punctuation">,</span>
            age<span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
            birthday<span class="token operator">:</span> <span class="token string">'696096000000'</span><span class="token punctuation">,</span>
            address<span class="token operator">:</span> <span class="token string">'北京市海淀区西二旗'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">'李小红'</span><span class="token punctuation">,</span>
            age<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
            birthday<span class="token operator">:</span> <span class="token string">'563472000000'</span><span class="token punctuation">,</span>
            address<span class="token operator">:</span> <span class="token string">'上海市浦东新区世纪大道'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">'周小伟'</span><span class="token punctuation">,</span>
            age<span class="token operator">:</span> <span class="token number">26</span><span class="token punctuation">,</span>
            birthday<span class="token operator">:</span> <span class="token string">'687024000000'</span><span class="token punctuation">,</span>
            address<span class="token operator">:</span> <span class="token string">'深圳市南山区深南大道'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        editIndex<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment">// 当前聚焦的输入框的行数</span>
        editName<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  <span class="token comment">// 第一列输入框，当然聚焦的输入框的输入内容，与 data 分离避免重构的闪烁</span>
        editAge<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  <span class="token comment">// 第二列输入框</span>
        editBirthday<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  <span class="token comment">// 第三列输入框</span>
        editAddress<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  <span class="token comment">// 第四列输入框</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">handleEdit</span> <span class="token punctuation">(</span><span class="token parameter">row<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>editName <span class="token operator">=</span> row<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>editAge <span class="token operator">=</span> row<span class="token punctuation">.</span>age<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>editAddress <span class="token operator">=</span> row<span class="token punctuation">.</span>address<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>editBirthday <span class="token operator">=</span> row<span class="token punctuation">.</span>birthday<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>editIndex <span class="token operator">=</span> index<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">handleSave</span> <span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>editName<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>editAge<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>birthday <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>editBirthday<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>address <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>editAddress<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>editIndex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">getBirthday</span> <span class="token punctuation">(</span><span class="token parameter">birthday</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>birthday<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> year <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> month <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> day <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>year<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>month<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>day<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>示例中在 <code>&lt;table-slot&gt;</code> 内的每一个 <code>&lt;template&gt;</code> 就对应某一列的 slot-scope 模板，通过配置的 <code>slot</code> 字段，指定具名的 slot-scope。可以看到，基本是把 Render 函数还原成了 html 的写法，这样看起来直接多了，渲染效果是完全一样的。在 slot-scope 中，平时怎么写组件，这里就怎么写，Vue.js 所有的 API 都是可以直接使用的。</p> <p>方案一是最优解，一般情况下，使用这种方案就可以了，其余两种方案是基于 Render 的。</p> <h2 id="方案二"><a href="#方案二" class="header-anchor">#</a> 方案二</h2> <p>第二种方案，不需要修改原先的 Table 组件代码，只是在使用层面修改即可。先来看具体的使用代码，然后再做分析。注意，这里使用的 Table 组件，仍然是上一节 <code>src/components/table-render</code> 的组件，它只有 Render 函数，没有定义 slot-scope：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> src<span class="token operator">/</span>views<span class="token operator">/</span>table<span class="token operator">-</span>render<span class="token punctuation">.</span>vue 的改写 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>table<span class="token operator">-</span>render ref<span class="token operator">=</span><span class="token string">&quot;table&quot;</span> <span class="token operator">:</span>columns<span class="token operator">=</span><span class="token string">&quot;columns&quot;</span> <span class="token operator">:</span>data<span class="token operator">=</span><span class="token string">&quot;data&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>template slot<span class="token operator">-</span>scope<span class="token operator">=</span><span class="token string">&quot;{ row, index }&quot;</span> slot<span class="token operator">=</span><span class="token string">&quot;name&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;editName&quot;</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;editIndex === index&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> row<span class="token punctuation">.</span>name <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

      <span class="token operator">&lt;</span>template slot<span class="token operator">-</span>scope<span class="token operator">=</span><span class="token string">&quot;{ row, index }&quot;</span> slot<span class="token operator">=</span><span class="token string">&quot;age&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;editAge&quot;</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;editIndex === index&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> row<span class="token punctuation">.</span>age <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

      <span class="token operator">&lt;</span>template slot<span class="token operator">-</span>scope<span class="token operator">=</span><span class="token string">&quot;{ row, index }&quot;</span> slot<span class="token operator">=</span><span class="token string">&quot;birthday&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;editBirthday&quot;</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;editIndex === index&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">getBirthday</span><span class="token punctuation">(</span>row<span class="token punctuation">.</span>birthday<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

      <span class="token operator">&lt;</span>template slot<span class="token operator">-</span>scope<span class="token operator">=</span><span class="token string">&quot;{ row, index }&quot;</span> slot<span class="token operator">=</span><span class="token string">&quot;address&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">&quot;text&quot;</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;editAddress&quot;</span> v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;editIndex === index&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>span v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> row<span class="token punctuation">.</span>address <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

      <span class="token operator">&lt;</span>template slot<span class="token operator">-</span>scope<span class="token operator">=</span><span class="token string">&quot;{ row, index }&quot;</span> slot<span class="token operator">=</span><span class="token string">&quot;action&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;editIndex === index&quot;</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;handleSave(index)&quot;</span><span class="token operator">&gt;</span>保存<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;editIndex = -1&quot;</span><span class="token operator">&gt;</span>取消<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">&quot;handleEdit(row, index)&quot;</span><span class="token operator">&gt;</span>操作<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>table<span class="token operator">-</span>render<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  <span class="token keyword">import</span> TableRender <span class="token keyword">from</span> <span class="token string">'../components/table-render/table.vue'</span><span class="token punctuation">;</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    components<span class="token operator">:</span> <span class="token punctuation">{</span> TableRender <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        columns<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            title<span class="token operator">:</span> <span class="token string">'姓名'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">h<span class="token punctuation">,</span> <span class="token punctuation">{</span> row<span class="token punctuation">,</span> column<span class="token punctuation">,</span> index <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>
                <span class="token string">'div'</span><span class="token punctuation">,</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>table<span class="token punctuation">.</span>$scopedSlots<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                  row<span class="token operator">:</span> row<span class="token punctuation">,</span>
                  column<span class="token operator">:</span> column<span class="token punctuation">,</span>
                  index<span class="token operator">:</span> index
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
              <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            title<span class="token operator">:</span> <span class="token string">'年龄'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">h<span class="token punctuation">,</span> <span class="token punctuation">{</span> row<span class="token punctuation">,</span> column<span class="token punctuation">,</span> index <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>
                <span class="token string">'div'</span><span class="token punctuation">,</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>table<span class="token punctuation">.</span>$scopedSlots<span class="token punctuation">.</span><span class="token function">age</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                  row<span class="token operator">:</span> row<span class="token punctuation">,</span>
                  column<span class="token operator">:</span> column<span class="token punctuation">,</span>
                  index<span class="token operator">:</span> index
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
              <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            title<span class="token operator">:</span> <span class="token string">'出生日期'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">h<span class="token punctuation">,</span> <span class="token punctuation">{</span> row<span class="token punctuation">,</span> column<span class="token punctuation">,</span> index <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>
                <span class="token string">'div'</span><span class="token punctuation">,</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>table<span class="token punctuation">.</span>$scopedSlots<span class="token punctuation">.</span><span class="token function">birthday</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                  row<span class="token operator">:</span> row<span class="token punctuation">,</span>
                  column<span class="token operator">:</span> column<span class="token punctuation">,</span>
                  index<span class="token operator">:</span> index
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
              <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            title<span class="token operator">:</span> <span class="token string">'地址'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">h<span class="token punctuation">,</span> <span class="token punctuation">{</span> row<span class="token punctuation">,</span> column<span class="token punctuation">,</span> index <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>
                <span class="token string">'div'</span><span class="token punctuation">,</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>table<span class="token punctuation">.</span>$scopedSlots<span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                  row<span class="token operator">:</span> row<span class="token punctuation">,</span>
                  column<span class="token operator">:</span> column<span class="token punctuation">,</span>
                  index<span class="token operator">:</span> index
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
              <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            title<span class="token operator">:</span> <span class="token string">'操作'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">h<span class="token punctuation">,</span> <span class="token punctuation">{</span> row<span class="token punctuation">,</span> column<span class="token punctuation">,</span> index <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>
                <span class="token string">'div'</span><span class="token punctuation">,</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>table<span class="token punctuation">.</span>$scopedSlots<span class="token punctuation">.</span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                  row<span class="token operator">:</span> row<span class="token punctuation">,</span>
                  column<span class="token operator">:</span> column<span class="token punctuation">,</span>
                  index<span class="token operator">:</span> index
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
              <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        editIndex<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment">// 当前聚焦的输入框的行数</span>
        editName<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  <span class="token comment">// 第一列输入框，当然聚焦的输入框的输入内容，与 data 分离避免重构的闪烁</span>
        editAge<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  <span class="token comment">// 第二列输入框</span>
        editBirthday<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  <span class="token comment">// 第三列输入框</span>
        editAddress<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  <span class="token comment">// 第四列输入框</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">handleEdit</span> <span class="token punctuation">(</span><span class="token parameter">row<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>editName <span class="token operator">=</span> row<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>editAge <span class="token operator">=</span> row<span class="token punctuation">.</span>age<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>editAddress <span class="token operator">=</span> row<span class="token punctuation">.</span>address<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>editBirthday <span class="token operator">=</span> row<span class="token punctuation">.</span>birthday<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>editIndex <span class="token operator">=</span> index<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">handleSave</span> <span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>editName<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>editAge<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>birthday <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>editBirthday<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>address <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>editAddress<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>editIndex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">getBirthday</span> <span class="token punctuation">(</span><span class="token parameter">birthday</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>birthday<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> year <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> month <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> day <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>year<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>month<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>day<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token string">'王小明'</span><span class="token punctuation">,</span>
          age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
          birthday<span class="token operator">:</span> <span class="token string">'919526400000'</span><span class="token punctuation">,</span>
          address<span class="token operator">:</span> <span class="token string">'北京市朝阳区芍药居'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token string">'张小刚'</span><span class="token punctuation">,</span>
          age<span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
          birthday<span class="token operator">:</span> <span class="token string">'696096000000'</span><span class="token punctuation">,</span>
          address<span class="token operator">:</span> <span class="token string">'北京市海淀区西二旗'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token string">'李小红'</span><span class="token punctuation">,</span>
          age<span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
          birthday<span class="token operator">:</span> <span class="token string">'563472000000'</span><span class="token punctuation">,</span>
          address<span class="token operator">:</span> <span class="token string">'上海市浦东新区世纪大道'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token string">'周小伟'</span><span class="token punctuation">,</span>
          age<span class="token operator">:</span> <span class="token number">26</span><span class="token punctuation">,</span>
          birthday<span class="token operator">:</span> <span class="token string">'687024000000'</span><span class="token punctuation">,</span>
          address<span class="token operator">:</span> <span class="token string">'深圳市南山区深南大道'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>在 slot-scope 的使用上（即 template 的内容），与方案一是完全一致的，可以看到，在 column 的定义上，仍然使用了 render 字段，只不过每个 render 都渲染了一个 div 节点，而这个 div 的内容，是指定来在 <code>&lt;table-render&gt;</code> 中定义的 slot-scope：</p> <div class="language- extra-class"><pre class="language-text"><code>render: (h, { row, column, index }) =&gt; {
  return h(
    'div',
    this.$refs.table.$scopedSlots.name({
      row: row,
      column: column,
      index: index
    })
  )
}
</code></pre></div><p>这正是 Render 函数灵活的一个体现，使用 <code>$scopedSlots</code> 可以访问 slot-scope，所以上面这段代码的意思是，name 这一列仍然是使用 Functional Render，只不过 Render 的是一个预先定义好的 slot-scope 模板。</p> <p>有一点需要注意的是，示例中的 <code>data</code> 默认是空数组，而在 mounted 里才赋值的，是因为这样定义的 slot-scope，初始时读取 <code>this.$refs.table.$scopedSlots</code> 是读不到的，会报错，当没有数据时，也就不会去渲染，也就避免了报错。</p> <p>这种方案虽然可行，但归根到底是一种 hack，不是非常推荐，之所以列出来，是为了对 Render 和 slot-scope 有进一步的认识。</p> <h2 id="方案三"><a href="#方案三" class="header-anchor">#</a> 方案三</h2> <p>第 3 中方案的思路和第 2 种是一样的，它介于方案 1 与方案 2 之间。这种方案要修改 Table 组件代码，但是用例与方案 1 完全一致。</p> <p>在方案 2 中，我们是通过修改用例使用 slot-scope 的，也就是说 Table 组件本身没有支持 slot-scope，是我们“强加”上去的，如果把强加的部分，集成到 Table 内，那对使用者就很友好了，同时也避免了初始化报错，不得不把 data 写在 mounted 的问题。</p> <p>保持方案 1 的用例不变，修改 <code>src/components/table-render</code> 中的代码。为了同时兼容 Render 与 slot-scope，我们在 <code>table-render</code> 下新建一个 slot.js 的文件：</p> <div class="language- extra-class"><pre class="language-text"><code>// src/components/table-render/slot.js
export default {
  functional: true,
  inject: ['tableRoot'],
  props: {
    row: Object,
    column: Object,
    index: Number
  },
  render: (h, ctx) =&gt; {
    return h('div', ctx.injections.tableRoot.$scopedSlots[ctx.props.column.slot]({
      row: ctx.props.row,
      column: ctx.props.column,
      index: ctx.props.index
    }));
  }
};
</code></pre></div><p>它仍然是一个 Functional Render，使用 <code>inject</code> 注入了父级组件 table.vue（下文改写） 中提供的实例 <code>tableRoot</code>。在 render 里，也是通过方案 2 中使用 <code>$scopedSlots</code> 定义的 slot，不过这是在组件级别定义，对用户来说是透明的，只要按方案 1 的用例来写就可以了。</p> <p>table.vue 也要做一点修改：</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> src<span class="token operator">/</span>components<span class="token operator">/</span>table<span class="token operator">-</span>slot<span class="token operator">/</span>table<span class="token punctuation">.</span>vue 的改写，部分代码省略 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>table<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>thead<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>tr<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>th v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;col in columns&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> col<span class="token punctuation">.</span>title <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>th<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>thead<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>tbody<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>tr v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;(row, rowIndex) in data&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>td v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;col in columns&quot;</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>template v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;'render' in col&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>Render <span class="token operator">:</span>row<span class="token operator">=</span><span class="token string">&quot;row&quot;</span> <span class="token operator">:</span>column<span class="token operator">=</span><span class="token string">&quot;col&quot;</span> <span class="token operator">:</span>index<span class="token operator">=</span><span class="token string">&quot;rowIndex&quot;</span> <span class="token operator">:</span>render<span class="token operator">=</span><span class="token string">&quot;col.render&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Render<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>template v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;'slot' in col&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>slot<span class="token operator">-</span>scope <span class="token operator">:</span>row<span class="token operator">=</span><span class="token string">&quot;row&quot;</span> <span class="token operator">:</span>column<span class="token operator">=</span><span class="token string">&quot;col&quot;</span> <span class="token operator">:</span>index<span class="token operator">=</span><span class="token string">&quot;rowIndex&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">-</span>scope<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>template v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> row<span class="token punctuation">[</span>col<span class="token punctuation">.</span>key<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>td<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>tr<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>tbody<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>table<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  <span class="token keyword">import</span> Render <span class="token keyword">from</span> <span class="token string">'./render.js'</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> SlotScope <span class="token keyword">from</span> <span class="token string">'./slot.js'</span><span class="token punctuation">;</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    components<span class="token operator">:</span> <span class="token punctuation">{</span> Render<span class="token punctuation">,</span> SlotScope <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">provide</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        tableRoot<span class="token operator">:</span> <span class="token keyword">this</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    props<span class="token operator">:</span> <span class="token punctuation">{</span>
      columns<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> Array<span class="token punctuation">,</span>
        <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      data<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> Array<span class="token punctuation">,</span>
        <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>因为 slot-scope 模板是写在 table.vue 中的（对使用者来说，相当于写在组件 <code>&lt;table-slot&gt;&lt;/table-slot&gt;</code> 之间），所以在 table.vue 中使用 provide 向下提供了 Table 的实例，这样在 slot.js 中就可以通过 inject 访问到它，继而通过 <code>$scopedSlots</code> 获取到 slot。需要注意的是，在 Functional Render 是没有 this 上下文的，都是通过 h 的第二个参数临时上下文 ctx 来访问 prop、inject 等的。</p> <p>方案 3 也是推荐使用的，当 Table 的功能足够复杂，层级会嵌套的比较深，那时方案 1 的 slot 就不会定义在第一级组件中，中间可能会隔许多组件，slot 就要一层层中转，相比在任何地方都能直接使用的 Render 就要麻烦了。所以，如果你的组件层级简单，推荐用第一种方案；如果你的组件已经成型（某 API 基于 Render 函数），但一时间不方便支持 slot-scope，而使用者又想用，那就选方案 2；如果你的组件已经成型（某 API 基于 Render 函数），但组件层级复杂，要按方案 1 那样支持 slot-scope 可能改动较大，还有可能带来新的 bug，那就用方案 3，它不会破坏原有的任何内容，但会额外支持 slot-scope 用法，关键是改动简单。</p> <h2 id="结语"><a href="#结语" class="header-anchor">#</a> 结语</h2> <p>理论上，绝大多数能用 Render 的地方，都可以用 slot-scope。对于极客来说，喜欢挑战各种新奇的写法，所以会在 Vue.js 中大量使用 Render 函数、JSX 甚至 TS；而对于求稳的开发者来说，常规的 template、slot、slot-scope 写法会是好的选择。如果非要选一种，那要从你团队的整体情况来定，如果团队大部分是写后端为主的，那可能更倾向于 TS；如果写过 React，或许 JSX 是不错的选择；如果实在不知道选什么，那就求稳吧！</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Article/code/vue组件精讲/12.实战 5：可用 Render 自定义列的表格组件——Table.html" class="prev">
        实战 5：可用 Render 自定义列的表格组件——Table
      </a></span> <span class="next"><a href="/Article/code/vue组件精讲/14.递归组件与动态组件.html">
        递归组件与动态组件
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div class="cat-container" data-v-a13867c0><canvas id="vuepress-cat" width="280" height="250" class="live2d" data-v-a13867c0></canvas></div></div></div>
    <script src="/assets/js/app.3f86075b.js" defer></script><script src="/assets/js/2.b61884c0.js" defer></script><script src="/assets/js/15.8f783edc.js" defer></script>
  </body>
</html>
