<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>源于生活</title>
    <meta name="description" content="write something！">
    
    
    <link rel="preload" href="/assets/css/0.styles.97ad5445.css" as="style"><link rel="preload" href="/assets/js/app.beb6e1a2.js" as="script"><link rel="preload" href="/assets/js/2.fb87c654.js" as="script"><link rel="preload" href="/assets/js/28.e8a55e3b.js" as="script"><link rel="prefetch" href="/assets/js/10.76b112d8.js"><link rel="prefetch" href="/assets/js/11.aa7e37d8.js"><link rel="prefetch" href="/assets/js/12.16c26b7b.js"><link rel="prefetch" href="/assets/js/13.a5ff24d9.js"><link rel="prefetch" href="/assets/js/14.76e2d83a.js"><link rel="prefetch" href="/assets/js/15.7531a012.js"><link rel="prefetch" href="/assets/js/16.32b1eed6.js"><link rel="prefetch" href="/assets/js/17.98086da0.js"><link rel="prefetch" href="/assets/js/18.ce8a9952.js"><link rel="prefetch" href="/assets/js/19.1b9a8c39.js"><link rel="prefetch" href="/assets/js/20.216b83ff.js"><link rel="prefetch" href="/assets/js/21.caf31454.js"><link rel="prefetch" href="/assets/js/22.14b71624.js"><link rel="prefetch" href="/assets/js/23.8b830af2.js"><link rel="prefetch" href="/assets/js/24.38b52520.js"><link rel="prefetch" href="/assets/js/25.1b35fa6f.js"><link rel="prefetch" href="/assets/js/26.a60509d3.js"><link rel="prefetch" href="/assets/js/27.d1de37b1.js"><link rel="prefetch" href="/assets/js/29.6d4afabc.js"><link rel="prefetch" href="/assets/js/3.6e21b941.js"><link rel="prefetch" href="/assets/js/30.7d58ead2.js"><link rel="prefetch" href="/assets/js/31.1506f023.js"><link rel="prefetch" href="/assets/js/4.c063c58b.js"><link rel="prefetch" href="/assets/js/5.e9ec8af5.js"><link rel="prefetch" href="/assets/js/6.1d843266.js"><link rel="prefetch" href="/assets/js/7.af3685bd.js"><link rel="prefetch" href="/assets/js/8.516f11f2.js"><link rel="prefetch" href="/assets/js/9.6b635f29.js">
    <link rel="stylesheet" href="/assets/css/0.styles.97ad5445.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">源于生活</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>关于code</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Article/code/地图学习.html" class="sidebar-link">地图学习笔记</a></li><li><a href="/Article/code/数据双向绑定的分析和简单实现.html" class="sidebar-link">数据双向绑定的分析和简单实现</a></li><li><a href="/Article/code/多语言.html" class="sidebar-link">前端多语言方案</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vue组件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>关于生活</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Article/life/选房.html" class="sidebar-link">待选名单</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>√# hui-tools
标签（空格分隔）： hui cli</p> <hr> <h3 id="起因"><a href="#起因" aria-hidden="true" class="header-anchor">#</a> 起因</h3> <p>在实际的开发过程中，从零开始建立项目的结构是一件让人头疼的事情，所以各种各样的脚手架工具应运而生。yoeman，express-generator和vue-cli便是当中之一。它们功能丰富，但最核心的功能都是能够快速搭建一个完整的项目的结构，开发者只需要在生成的项目结构的基础上进行开发即可，非常简单高效。</p> <h3 id="原理"><a href="#原理" aria-hidden="true" class="header-anchor">#</a> 原理</h3> <p>yoeman搭建项目需要提供yoeman-generator。yoeman-generator本质上就是一个具备完整文件结构的项目样板，用户需要手动地把这些generator下载到本地，然后yoeman就会根据这些generator自动生成各种不同的项目。</p> <p>vue-cli提供了相当丰富的选项和设定功能，但是其本质也是从远程仓库把不同的模版拉取到本地，而并非是什么“本地生成”的黑科技。</p> <p>这样看来，思路也就有了——首先建立不同的样板项目，然后脚手架根据用户的指令引用样板项目生成实际项目。样板项目可以内置在脚手架当中，也可以部署在远程仓库。为了更广的适用范围，hui-tools采用的是第二种方式。</p> <h3 id="选型"><a href="#选型" aria-hidden="true" class="header-anchor">#</a> 选型</h3> <p>node.js：整个脚手架工具的根本组成部分，推荐使用最新的版本。</p> <p><a href="https://github.com/tj/commander.js" target="_blank" rel="noopener noreferrer">commander.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：组织和处理命令行的输入。<a href="https://blog.csdn.net/qq_40129176/article/details/80816853" target="_blank" rel="noopener noreferrer">中文介绍地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://github.com/sboudrias/Inquirer.js" target="_blank" rel="noopener noreferrer">Inquirer.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> :为NodeJs做一个可嵌入式的美观的命令行界面 <a href="https://www.jianshu.com/p/db8294cfa2f7" target="_blank" rel="noopener noreferrer">中文学习地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>chalk:改变输出文字的颜色</p> <p>ora:小图标（loading、succeed、warn等）</p> <h3 id="整体架构"><a href="#整体架构" aria-hidden="true" class="header-anchor">#</a> 整体架构</h3> <p>整体架构，看图：</p> <p><img src="https://image-static.segmentfault.com/386/987/3869878572-57a5535c106ab_articlex" alt="此处输入图片的描述">
首先明白模版的概念。一个模版就是一个项目的样板，包含项目的完整结构和信息。
模版的信息都存放在一个叫做templates.json的文件当中。
用户可以通过命令行对templates.json进行添加、删除、罗列的操作。
通过选择不同的模版，hui会自动从远程仓库把相应的模板拉取到本地，完成项目的搭建。</p> <p>最终整个脚手架的文件结构如下：</p> <pre><code>|__ bin
    |__ hui
  |__ command
    |__ add.js
    |__ delete.js
    |__ init.js
    |__ list.js
  |__ node_modules
  |__ package.json
  |__ templates.json
</code></pre> <h2 id="入口文件"><a href="#入口文件" aria-hidden="true" class="header-anchor">#</a> 入口文件</h2> <p>首先建立项目，在package.json里面写入依赖并执行npm install</p> <pre><code>&quot;dependencies&quot;: {
    &quot;chalk&quot;: &quot;^1.1.3&quot;,
    &quot;commander&quot;: &quot;^2.9.0&quot;,
    &quot;download-git-repo&quot;: &quot;^1.0.0&quot;,
    &quot;handlebars&quot;: &quot;^4.0.8&quot;,
    &quot;inquirer&quot;: &quot;^3.0.6&quot;,
    &quot;ora&quot;: &quot;^1.2.0&quot;
  }
</code></pre> <p>在根目录下建立\bin文件夹，在里面建立一个无后缀名的hui文件。这个bin\hui文件是整个脚手架的入口文件，所以我们首先对它进行编写。</p> <p>首先是一些初始化的代码：</p> <pre><code>#!/usr/bin/env node --harmony
'use strict'
 // 定义脚手架的文件路径
process.env.NODE_PATH = __dirname + '/../node_modules/'

const program = require('commander')

 // 定义当前版本
program
    .version(require('../package').version )

// 定义使用方法
program
    .usage('&lt;command&gt;')
前文的架构图中可以知道，脚手架支持用户输入4种不同的命令。现在我们来写处理这4种命令的方法：
    program
    .command('list')
    .description('List all the templates')
    .alias('l')
    .action(() =&gt; {
        require('../command/list')()
    })

program
    .command('init')
    .description('Generate a new project')
  .alias('i')
  .action(() =&gt; {
    require('../command/init')()
  })

program
    .command('delete')
    .description('Delete a template')
    .alias('d')
    .action(() =&gt; {
        require('../command/delete')()
    })
</code></pre> <p>使用node运行这个文件，看到输出如下，证明入口文件已经编写完成了。
Usage: hui <command></command></p> <pre><code>Commands:

    add|a      新增模板
    list|l     展示所有模板
    init|i     初始化模板
    delete|d   删除模板
</code></pre> <h2 id="处理用户输入"><a href="#处理用户输入" aria-hidden="true" class="header-anchor">#</a> 处理用户输入</h2> <p>在项目根目录下建立\command文件夹，专门用来存放命令处理文件。
在根目录下建立templates.json文件并写入如下内容，用来存放模版信息：</p> <pre><code>{&quot;tpl&quot;:{}}
</code></pre> <h2 id="添加模板"><a href="#添加模板" aria-hidden="true" class="header-anchor">#</a> 添加模板</h2> <p>进入\command并新建add.js文件</p> <pre><code>const { prompt } = require('inquirer')
const { writeFile } = require('fs')
const { listTable } = require(`${__dirname}/../utils`)

let tplList = require(`${__dirname}/../templates`)

const question = [
  {
    type: 'input',
    name: 'name',
    message: '给你的模板选个名字吧:',
    validate (val) {
      if (tplList[val]) {
        return '重名了!'
      } else if (val === '') {
        return '名字是必须的!'
      } else {
        return true
      }
    }
  },
  {
    type: 'input',
    name: 'place',
    message: '模板拥有者:',
    validate (val) {
      if (val !== '') {
        return true
      }
      return '必填项!'
    }
  },
  {
    type: 'input',
    name: 'branch',
    message: '模板分支(git仓库):',
    default: 'master'
  }
]

module.exports = prompt(question).then(({ name, place, branch }) =&gt; {
  tplList[name] = {}
  tplList[name]['owner/name'] = place
  tplList[name]['branch'] = branch
// 把模板信息写入templates.json
  writeFile(`${__dirname}/../templates.json`, JSON.stringify(tplList), 'utf-8', (err) =&gt; {
    if (err) {
      console.log(err)
    }
    listTable(tplList, '模板创立成功!')
  })
})
</code></pre> <h2 id="删除模板"><a href="#删除模板" aria-hidden="true" class="header-anchor">#</a> 删除模板</h2> <p>同样的，在\command文件夹下建立delete.js文件</p> <pre><code>const { prompt } = require('inquirer')
const { writeFile } = require('fs')
const { listTable } = require(`${__dirname}/../utils`)

let tplList = require(`${__dirname}/../templates`)

const question = [
  {
    type: 'input',
    name: 'name',
    message: '你想删除哪个模板?:',
    validate (val) {
      if (tplList[val]) {
        return true
      } else if (val === '') {
        return '请输入模板名!'
      } else if (!tplList[val]) {
        return '该模板已删除.'
      }
    }
  }
]

module.exports = prompt(question).then(({ name }) =&gt; {
  delete tplList[name]

  writeFile(`${__dirname}/../templates.json`, JSON.stringify(tplList), 'utf-8', (err) =&gt; {
    if (err) {
      console.log(err)
    }
    listTable(tplList, '模板删除成功!')
  })
})
</code></pre> <h2 id="罗列模板"><a href="#罗列模板" aria-hidden="true" class="header-anchor">#</a> 罗列模板</h2> <p>\command文件夹下建立list.js文件</p> <pre><code>const { listTable } = require(`${__dirname}/../utils`)

let tplList = require(`${__dirname}/../templates`)

module.exports = listTable(tplList)
</code></pre> <h2 id="构建项目"><a href="#构建项目" aria-hidden="true" class="header-anchor">#</a> 构建项目</h2> <p>现在来到我们最重要的部分——构建项目。同样的，在\command目录下新建一个叫做init.js的文件</p> <pre><code>const { prompt } = require('inquirer')
const { writeFile } = require('fs')
const { listTable } = require(`${__dirname}/../utils`)
const exec = require('child_process').exec
const { resolve } = require('path')
const chalk = require('chalk')
const download = require('download-git-repo')
const ora = require('ora')

let tplList = require(`${__dirname}/../templates`)

const question = [
  {
    type: 'input',
    name: 'name',
    message: '模板名:',
    validate (val) {
      if (tplList[val]) {
        return true
      } else if (val === '') {
        return '模板名是必填!'
      } else if (!tplList[val]) {
        return '该模板不存在.'
      }
    }
  },
  {
    type: 'input',
    name: 'project',
    message: '项目名:',
    validate (val) {
      if (val !== '') {
        return true
      }
      return '项目名是必须的!'
    }
  }
  // {
  //   type: 'input',
  //   name: 'place',
  //   message: '选择路径创建项目:',
  //   default: './'
  // }
]

module.exports = prompt(question).then(({ name, project, place }) =&gt; {
  const gitPlace = tplList[name]['owner/name']
  const gitBranch = tplList[name]['branch']
  const spinner = ora('模板下载中...')

  spinner.start()
  // git命令，远程拉取项目并自定义项目名
  let cmdStr = `git clone ${gitBranch} ${project} &amp;&amp; cd ${project}`
  exec(cmdStr, (error, stdout, stderr) =&gt; {
    if (error) {
      console.log(error)
      process.exit()
    }
    spinner.stop()
    console.log(chalk.green('新项目初始化成功!'))
    process.exit()
  })
})
</code></pre> <h2 id="全局使用"><a href="#全局使用" aria-hidden="true" class="header-anchor">#</a> 全局使用</h2> <p>为了可以全局使用，我们需要在package.json里面设置一下：</p> <pre><code>&quot;bin&quot;: {
    &quot;hui&quot;: &quot;bin/hui&quot;
  },
</code></pre> <p>本地调试的时候，在根目录下执行</p> <p>npm link
即可把hui命令绑定到全局，以后就可以直接以hui作为命令开头而无需敲入长长的node hui之类的命令了。</p> <h2 id="效果展示"><a href="#效果展示" aria-hidden="true" class="header-anchor">#</a> 效果展示</h2></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.beb6e1a2.js" defer></script><script src="/assets/js/2.fb87c654.js" defer></script><script src="/assets/js/28.e8a55e3b.js" defer></script>
  </body>
</html>
